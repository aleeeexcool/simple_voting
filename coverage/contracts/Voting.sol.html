<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Voting.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Voting.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/47</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.7;
&nbsp;
import "@openzeppelin/contracts/utils/Address.sol";
&nbsp;
contract Voting {
 
    address public owner;
    uint public counter;
    uint public minCandidates = 2;
    uint public maxCandidates;
    uint8 public immutable Comission; 
&nbsp;
    struct Candidate {
        uint balance;
        bool isExistOnThisVoting;
    }
&nbsp;
    struct _Voting {
        bool started;
        address Winner;
        uint StartDate;
        uint WinnerBalance;
        uint Bank;
        uint Period;
        mapping(address =&gt; Candidate) Candidates;
    }
&nbsp;
    mapping(uint =&gt; _Voting) private Votings;
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyOwner() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == owner, "Sorry, but you are not an owner!")</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(uint _maxCandidates, uint8 _comission) {</span>
        owner = msg.sender;
        Comission = _comission;
        maxCandidates = _maxCandidates;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function addVoting(address[] calldata _candidates, uint _period) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(minCandidates &lt;= _candidates.length &amp;&amp; _candidates.length &lt; maxCandidates, "The number of candidates must comply with the boting rules!")</span>;
        Votings[counter].Period = _period; 
<span class="cstat-no" title="statement not covered" >        for( uint i = 0; i &lt; _candidates.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            addCandidate(counter, _candidates[i])</span>;
            }
<span class="cstat-no" title="statement not covered" >        emit votingDraftCreated(counter);</span>
        counter++;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function editVotingPeriod(uint _id, uint _newPeriod) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].started = false, "The voting has already begun!")</span>;
        Votings[_id].Period = _newPeriod;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function addCandidate(uint _id, address _candidate) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(address(_candidate) != address(0), "This candidate with zero address!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Address.isContract(_candidate) == false, "A contract can't be a candidate!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].started, "The voting has already begun!")</span>;
        Votings[_id].Candidates[_candidate].isExistOnThisVoting = true;
<span class="cstat-no" title="statement not covered" >        emit candidateInfo(_id, _candidate, true);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function deleteCandidate(address _candidate, uint _id) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].started, "The voting has already begun!")</span>;
        Votings[_id].Candidates[_candidate].isExistOnThisVoting = false;
<span class="cstat-no" title="statement not covered" >        emit candidateInfo(_id, _candidate, false);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function startVoting(uint _id) public onlyOwner {</span>
        Votings[_id].started = true;
        Votings[_id].StartDate = block.timestamp;
<span class="cstat-no" title="statement not covered" >        emit votingStarted(_id, block.timestamp);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function takePartInVoting(uint _id, address _candidate) public payable {</span>
<span class="cstat-no" title="statement not covered" >        require(Address.isContract(msg.sender) == false, "A contract can't vote!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].started, "The voting doesn't start!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].StartDate + Votings[_id].Period &gt; block.timestamp, "The voting has ended!")</span>;
<span class="cstat-no" title="statement not covered" >        require(checkCandidate(_id, _candidate), "This candidates does not exist in this voting!")</span>;
&nbsp;
        Votings[_id].Candidates[_candidate].balance += msg.value;
        Votings[_id].Bank += msg.value;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (Votings[_id].Candidates[_candidate].balance &gt; Votings[_id].WinnerBalance) {</span>
            Votings[_id].WinnerBalance = Votings[_id].Candidates[_candidate].balance;
            Votings[_id].Winner = _candidate;
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function withDrawPrize(uint _id) public {</span>
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].started, "The voting doesn't start!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].StartDate + Votings[_id].Period &lt; block.timestamp, "The voting is not ended yet!")</span>;
<span class="cstat-no" title="statement not covered" >        require(msg.sender == Votings[_id].Winner, "You are not a winner!")</span>;
<span class="cstat-no" title="statement not covered" >        require(Votings[_id].Bank &gt; 0, "You have already receive your prize!")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint amount = Votings[_id].Bank;</span>
<span class="cstat-no" title="statement not covered" >        uint ownerComission = (Comission * amount) / 100;</span>
<span class="cstat-no" title="statement not covered" >        uint clearAmount = amount - ownerComission;</span>
        Votings[_id].Bank = 0;
<span class="cstat-no" title="statement not covered" >        payable(owner).transfer(ownerComission)</span>;
<span class="cstat-no" title="statement not covered" >        payable(msg.sender).transfer(clearAmount)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function checkCandidate(uint _id, address _candidate) public view returns(bool) {</span>
<span class="cstat-no" title="statement not covered" >        return(Votings[_id].Candidates[_candidate].isExistOnThisVoting);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getVotingInfo(uint256 _id) public view returns (</span>
        bool,
        uint256,
        uint256,
        uint256,
        uint256,
        address
        ) {
<span class="cstat-no" title="statement not covered" >            return(</span>
                Votings[_id].started,
                Votings[_id].StartDate,
                Votings[_id].WinnerBalance,
                Votings[_id].Bank,
                Votings[_id].Period,
                Votings[_id].Winner);
        }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setMaxCandidates(uint _maxCandidates) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(minCandidates &lt;= _maxCandidates, "Minimum number of candidates is 2")</span>;
        maxCandidates = _maxCandidates;
    }
&nbsp;
    event candidateInfo(uint indexed id, address indexed candidate, bool existOnThisVoting);
&nbsp;
    event votingDraftCreated(uint indexed id);
&nbsp;
    event votingStarted(uint indexed id, uint startDate);
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Feb 09 2023 15:26:13 GMT+0200 (Eastern European Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
